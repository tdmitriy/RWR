/*! rwr 10-11-2015 */
"use strict";var RwrApp=angular.module("RwrApp",["ngRoute","ngAnimate","angular-loading-bar","angularModalService","ui-notification","ui.bootstrap","ngMessages"]);RwrApp.config(["$routeProvider",function(a){a.when("/",{templateUrl:"/home",controller:"pageableController",reloadOnSearch:!1}),a.when("/management",{templateUrl:"/management",controller:"managementController"}),a.when("/management/:id",{templateUrl:"/management",controller:"managementController"}),a.when("/404",{templateUrl:"/404",controller:"pageNotFoundController"}),a.otherwise({redirectTo:"/404"})}]),RwrApp.controller("formItemsController",["$scope",function(a){a.date={format:"yyyy-MM-dd",isOpenedDateOfAddition:!1,isOpenedDateOfInterview:!1},a.openDateOfAddition=function(b){b.preventDefault(),b.stopPropagation(),a.date.isOpenedDateOfAddition=!0},a.openDateOfInterview=function(b){b.preventDefault(),b.stopPropagation(),a.date.isOpenedDateOfInterview=!0},a.dropdown={isOpen:!1},a.toggleDropdown=function(b){b.preventDefault(),b.stopPropagation(),a.dropdown.isOpen=!a.dropdown.isOpen}}]),RwrApp.controller("managementController",["$scope","$route","appFactory","$location","$routeParams",function(a,b,c,d,e){var f=c.getSeekerFactory(),g=c.getPageableSeekerFactory(),h=(c.getModalService(),c.getNotifyMessageService()),i=c.getErrorService(),j=c.getDbTypesFactory();a.seekerForm={},a.seeker={},a.seekerUpdatable={id:null,firstName:null,lastName:null,dateOfAddition:new Date,dateOfInterview:null,contacts:{seekerEmails:[],seekerPhones:[],seekerIms:[]},seekerSkills:[]},a.inputFields={phoneField:null,emailField:null,imsField:null,skillField:null,skillRatingField:null},a.isEditableState=function(){var b=e.id;"undefined"!=typeof b&&null!==b&&(a.setEditableMode(!0),a.getSeekerById(b))},a.getSeekerById=function(b){f.getById(b).then(function(b){a.seekerUpdatable=b})},a.saveSeeker=function(b){a.resetErrors(),f.save(b).then(function(){a.backToTable(),h.successMessage("Seeker has been saved successfully.")})},a.deleteSeekerById=function(c){a.resetErrors(),f.deleteById(c).then(function(){b.reload(),h.successMessage("Seeker has been deleted successfully.")})},a.imsTypes=[],a.skillTypes=[],a.getImsTypes=function(){j.getImsTypes().then(function(b){a.imsTypes=b})},a.getSkillTypes=function(){j.getSkillTypes().then(function(b){a.skillTypes=b})},a.imsType=null,a.selectedImsType=function(b){a.imsType=b},a.skillType=null,a.selectedSkillType=function(b){a.skillType=b,a.inputFields.skillField=b.skillName,a.inputFields.skillRatingField=1},a.addPhoneToSeeker=function(b){if(""!==b.trim()){var c,d=a.seekerUpdatable.contacts.seekerPhones,e=!1;for(c=0;c<d.length;c++)if(d[c].phoneNumber===b){e=!0;break}e||(a.seekerUpdatable.contacts.seekerPhones.push({phoneNumber:b}),a.inputFields.phoneField=null)}},a.addEmailToSeeker=function(b){if(""!==b.trim()){var c,d=a.seekerUpdatable.contacts.seekerEmails,e=!1;for(c=0;c<d.length;c++)if(d[c].email===b){e=!0;break}e||(a.seekerUpdatable.contacts.seekerEmails.push({email:b}),a.inputFields.emailField=null)}},a.addImsToSeeker=function(b){if(""!==b.trim()){var c,d=a.imsType,e=a.seekerUpdatable.contacts.seekerIms,f=!1;if("undefined"!=typeof d&&null!==d){for(c=0;c<e.length;c++)if(e[c].imsType.id===d.id){f=!0;break}f||(a.seekerUpdatable.contacts.seekerIms.push({imsLogin:b,imsType:d}),a.imsType=null,a.inputFields.imsField=null)}}},a.addSkillToSeeker=function(b){if(null!==a.inputFields.skillRatingField||""!==a.inputFields.skillRatingField.trim())var c=a.skillType;var d,e=a.seekerUpdatable.seekerSkills,f=!1;for(d=0;d<e.length;d++)if(e[d].skillType.skillName.toLowerCase()===b.toLowerCase()){f=!0;break}("undefined"==typeof c||null===c)&&k(f,b),"undefined"!=typeof c&&null!==c&&l(f,c),a.getSkillTypes(),a.skillType=null,a.inputFields.skillField=null,a.inputFields.skillRatingField=null};var k=function(b,c){b||a.seekerUpdatable.seekerSkills.push({id:null,skillRating:a.inputFields.skillRatingField,skillType:{skillName:c.toLowerCase()}})},l=function(b,c){b||a.seekerUpdatable.seekerSkills.push({id:null,skillRating:a.inputFields.skillRatingField,skillType:c})};a.deletePhone=function(b){a.seekerUpdatable.contacts.seekerPhones.splice(b,1)},a.deleteEmail=function(b){a.seekerUpdatable.contacts.seekerEmails.splice(b,1)},a.deleteIms=function(b){a.seekerUpdatable.contacts.seekerIms.splice(b,1)},a.deleteSkill=function(b){a.seekerUpdatable.seekerSkills.splice(b,1)},a.resetSeekerModel=function(){a.seekerUpdatable={id:null,firstName:null,lastName:null,dateOfAddition:new Date,dateOfInterview:null,contacts:{seekerEmails:[],seekerPhones:[],seekerIms:[]},seekerSkills:[]}},a.skillRatingSetReadOnly=function(b){a.skillRating=b},a.backToTable=function(){var a=g.getPageableUrl();("undefined"==typeof a||null===a)&&(a=g.getDefaultHomeUrl()),d.url(a)},a.editableMode=null,a.setEditableMode=function(b){a.editableMode=b},a.isError=function(){return i.isError()},a.getErrors=function(){return i.getErrors()},a.resetErrors=function(){i.resetErrors()},a.isEditableState(),a.getImsTypes(),a.getSkillTypes()}]),RwrApp.controller("modalController",["$scope","close","modalService",function(a,b,c){a.modalOptions=c.getOptions(),a.close=function(a){b(a,500)}}]),RwrApp.controller("pageableController",["$scope","appFactory","$routeParams","$route","$location",function(a,b,c,d,e){var f=b.getErrorService(),g=b.getPageableSeekerFactory(),h=b.getSeekerFactory(),i=b.getModalService(),j=b.getNotifyMessageService();a.page={sortMode:!1,defaultFirstPage:1,defaultItemsPerPage:10,currentPage:1,maxPagerItemsSize:5,itemsPerPage:null,maxTotalItems:null},a.searcKeyword={},a.seekersPageable={},a.getSeekersNonSortableList=function(b,c){a.resetErrors(),("undefined"==typeof b||null===b)&&(b=a.page.defaultFirstPage),("undefined"==typeof c||null===c)&&(c=a.page.defaultItemsPerPage),g.getSeekersNonSortableList(b,c).then(function(d){a.seekersPageable=d,a.setCurrentPage(b),a.setItemsPerPage(c),a.setTotalNumberOfItems(a.seekersPageable.rowsCount)})},a.getSeekersPageableList=function(){a.page.sortMode===!0?a.getSeekersSortableList(e.search().page,e.search().max_records,e.search().order_by,e.search().sort_by):a.getSeekersNonSortableList(e.search().page,e.search().max_records)},a.getSeekersSortableList=function(b,c,d,e){a.resetErrors(),g.getSeekersSortableList(b,c,d,e).then(function(b){a.seekersPageable=b})},a.deleteSeekerByIdFromTable=function(b){a.checkLastItemInTable(),h.deleteById(b).then(function(){d.reload(),j.successMessage("Seeker has been deleted successfully.")})},a.editSeeker=function(b){a.savePageableUrl(),e.path("/management/"+b)},a.pageChanged=function(){e.search("page",a.page.currentPage),a.getSeekersNonSortableList(e.search().page,a.page.itemsPerPage)},a.setCurrentPage=function(b){a.page.currentPage=b},a.setItemsPerPage=function(b){a.page.itemsPerPage=b},a.setMaxPagerItemsSize=function(b){a.page.maxPagerItemsSize=b},a.setTotalNumberOfItems=function(b){a.page.maxTotalItems=b},a.setPageSortableMode=function(b){a.page.sortMode=b},a.savePageableUrl=function(){g.setPageableUrl(e.url())},a.checkLastItemInTable=function(){var b=a.seekersPageable.lastPage,c=a.seekersPageable.collection.length,d=e.search().page;b===!0&&1===c&&d>1&&e.search("page",d-1)},a.isError=function(){return f.isError()},a.getErrors=function(){return f.getErrors()},a.resetErrors=function(){return f.resetErrors()},a.modal={},a.modal.showConfirm=function(b){var c={bodyText:"Delete this seeker?"};i.show(c).then(function(c){c.element.modal(),c.close.then(function(c){"cancel"!==c&&("undefined"!=typeof b||null!==b)&&a.deleteSeekerByIdFromTable(b)})})},a.getSeekersPageableList()}]),RwrApp.service("errorService",[function(){var a={title:"",messages:null},b=!1;this.setErrors=function(c,d){b=!0,a.title=c,a.messages=d},this.resetErrors=function(){b=!1},this.getErrors=function(){return a},this.isError=function(){return b}}]),RwrApp.service("modalService",["ModalService",function(a){var b={controller:"modalController",templateUrl:"angular/template/alertModal.html",closeButtonText:"Cancel",actionButtonText:"Delete",headerText:"Confirmation",bodyText:"Perform this action?"};this.show=function(c){return"undefined"!=typeof c&&angular.extend(b,c),a.showModal(b)},this.getOptions=function(){return b}}]),RwrApp.filter("search",function(a){return function(b,c){if(!c||0===c.length)return b;var d=c.split(" ");return d.forEach(function(c){c&&c.length&&(b=a("filter")(b,c))}),b}}),RwrApp.factory("appFactory",["modalService","seekerFactory","errorService","notifyMessageService","pageableSeekerFactory","dbTypesFactory",function(a,b,c,d,e,f){return{getSeekerFactory:function(){return b},getModalService:function(){return a},getErrorService:function(){return c},getNotifyMessageService:function(){return d},getPageableSeekerFactory:function(){return e},getDbTypesFactory:function(){return f}}}]),RwrApp.factory("dbTypesFactory",["$http","$q","errorService",function(a,b,c){var d="service/seeker";return{getSkillTypes:function(){var e=b.defer();return a.get(d+"/getSkillTypes").then(function(a){e.resolve(a.data)},function(a){e.reject(a),c.setErrors("Could not get skills list.",a.data.errors)}),e.promise},getImsTypes:function(){var e=b.defer();return a.get(d+"/getImsTypes").then(function(a){e.resolve(a.data)},function(a){e.reject(a),c.setErrors("Could not get ims list.",a.data.errors)}),e.promise}}}]),RwrApp.service("notifyMessageService",["Notification",function(a){var b={delay:4e3,positionY:"top",positionX:"center"},c=function(a){var c='<i class="fa fa-fw fa-check-circle"></i>';return b.message=c+a,b};return{successMessage:function(b){return a.success(c(b))}}}]),RwrApp.factory("pageableSeekerFactory",["$http","$q","errorService","seekerFactory",function(a,b,c,d){var e="service/seeker",f=null,g="/#",h=null;return{getSeekersNonSortableList:function(d,f){var g=b.defer(),h=e+"/getSeekersPageable/?page="+d+"&max_records="+f;return a.get(h).then(function(a){g.resolve(a.data)},function(a){g.reject(a),c.setErrors("Could not load seekers list.",a.data.errors)}),g.promise},getSeekersSortableList:function(d,f,g,h){var i=b.defer(),j=e+"/getSeekersSortedPageable/?page="+d+"&max_records="+f+"&order_by="+g+"&sort_by="+h;return a.get(j).then(function(a){i.resolve(a.data)},function(a){i.reject(a),c.setErrors("Could not load seekers list.",a.data.errors)}),i.promise},getSharableSeekerId:function(){return h},setSharableSeekerId:function(a){h=a},getPageableUrl:function(){return f},getDefaultHomeUrl:function(){return g},setPageableUrl:function(a){f=a}}}]),RwrApp.factory("seekerFactory",["$http","$q","errorService",function(a,b,c){var d="service/seeker";return{getById:function(e){var f=b.defer();return a.get(d+"/show/"+e).then(function(a){f.resolve(a.data)},function(a){f.reject(a),c.setErrors("Could not find seeker.",a.data.errors)}),f.promise},save:function(e){e.id<=0&&(e.id=null);var f=b.defer();return a.post(d+"/save",e).then(function(a){f.resolve(a.data)},function(a){f.reject(a),c.setErrors("Could not save seeker.",a.data.errors)}),f.promise},deleteById:function(e){var f=b.defer();return a["delete"](d+"/delete/"+e).then(function(a){f.resolve(a.data)},function(a){f.reject(a),c.setErrors("Could not delete seeker.",a.data.errors)}),f.promise}}}]);